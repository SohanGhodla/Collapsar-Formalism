

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mesa_reader &mdash; PyMesaReader 3.1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="PyMesaReader 3.1.0 documentation" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> PyMesaReader
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../MesaData.html">MesaData</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../MesaLogDir.html">MesaLogDir</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../MesaProfileIndex.html">MesaProfileIndex</a><ul class="simple">
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PyMesaReader</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>mesa_reader</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for mesa_reader</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">join</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">class</span> <span class="nc">ProfileError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">HistoryError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ModelNumberError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">BadPathError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">UnknownFileTypeError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>


<div class="viewcode-block" id="MesaData"><a class="viewcode-back" href="../MesaData.html#mesa_reader.MesaData">[docs]</a><span class="k">class</span> <span class="nc">MesaData</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;Structure containing data from a Mesa output file.</span>

<span class="sd">    Reads a profile or history output file from mesa. Assumes a file with</span>
<span class="sd">    the following structure:</span>

<span class="sd">    - line 1: header names</span>
<span class="sd">    - line 2: header data</span>
<span class="sd">    - line 3: blank</span>
<span class="sd">    - line 4: main data names</span>
<span class="sd">    - line 5: main data values</span>

<span class="sd">    This structure can be altered by using the class methods</span>
<span class="sd">    MesaData.set_header_rows and MesaData.set_data_rows.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_name : str, optional</span>
<span class="sd">        File name to be read in. Default is &#39;LOGS/history.data&#39;, which works</span>
<span class="sd">        for scripts in a standard work directory with a standard logs directory</span>
<span class="sd">        for accessing the history data.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    file_name : str</span>
<span class="sd">        Path to file from which the data is read.</span>
<span class="sd">    bulk_data : numpy.ndarray</span>
<span class="sd">        The main data (line 6 and below) in record array format. Primarily</span>
<span class="sd">        accessed via the `data` method.</span>
<span class="sd">    bulk_names : tuple of str</span>
<span class="sd">        Tuple of all available data column names that are valid inputs for</span>
<span class="sd">        `data`. Essentially the column names in line 4 of `file_name`.</span>
<span class="sd">    header_data : dict</span>
<span class="sd">        Header data (line 2 of `file_name`) in dict format</span>
<span class="sd">    header_names : list of str</span>
<span class="sd">        List of all available header column names that are valid inputs for</span>
<span class="sd">        `header`. Essentially the column names in line 1 of `file_name`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">header_names_line</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">bulk_names_line</span> <span class="o">=</span> <span class="mi">6</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">set_header_name_line</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name_line</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">header_names_line</span> <span class="o">=</span> <span class="n">name_line</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">set_data_rows</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name_line</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">bulk_names_line</span> <span class="o">=</span> <span class="n">name_line</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;LOGS&#39;</span><span class="p">,</span> <span class="s1">&#39;history.data&#39;</span><span class="p">),</span>
                 <span class="n">file_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make a MesaData object from a Mesa output file.</span>

<span class="sd">        Reads a profile or history output file from mesa. Assumes a file with</span>
<span class="sd">        the following structure:</span>

<span class="sd">        line 1: header names</span>
<span class="sd">        line 2: header data</span>
<span class="sd">        line 3: blank</span>
<span class="sd">        line 4: main data names</span>
<span class="sd">        line 5: main data values</span>

<span class="sd">        This structure can be altered by using the class methods</span>
<span class="sd">        `MesaData.set_header_rows` and `MesaData.set_data_rows`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_name : str, optional</span>
<span class="sd">            File name to be read in. Default is &#39;LOGS/history.data&#39;</span>

<span class="sd">        file_type : str, optional</span>
<span class="sd">            File type of file to be read.  Default is None, which will</span>
<span class="sd">            auto-detect the type based on file extension.  Valid values are</span>
<span class="sd">            &#39;model&#39; (a saved model) and &#39;log&#39; (history or profile output).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span> <span class="o">=</span> <span class="n">file_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bulk_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bulk_names</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_names</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">()</span>

<div class="viewcode-block" id="MesaData.read_data"><a class="viewcode-back" href="../MesaData.html#mesa_reader.MesaData.read_data">[docs]</a>    <span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Decide if data file is log output or a model, then load the data</span>

<span class="sd">        Log files and models are structured differently, so different methods</span>
<span class="sd">        will be required to read in each. This method figures out which one</span>
<span class="sd">        should be called and then punts to that method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># attempt auto-detection of file_type (if not supplied)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.data&quot;</span><span class="p">,</span> <span class="s2">&quot;.log&quot;</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.mod&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span> <span class="o">=</span> <span class="s1">&#39;model&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UnknownFileTypeError</span><span class="p">(</span><span class="s2">&quot;Unknown file type for file </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">))</span>

        <span class="c1"># punt to reading method appropriate for each file type</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_model_data</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_log_data</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UnknownFileTypeError</span><span class="p">(</span><span class="s2">&quot;Unknown file type </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span><span class="p">))</span></div>

<div class="viewcode-block" id="MesaData.read_log_data"><a class="viewcode-back" href="../MesaData.html#mesa_reader.MesaData.read_log_data">[docs]</a>    <span class="k">def</span> <span class="nf">read_log_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads in or update data from the original log (.data or .log) file.</span>

<span class="sd">        This re-reads the data from the originally-provided file name. Mostly</span>
<span class="sd">        useful if the data file has been changed since it was first read in or</span>
<span class="sd">        if the class methods MesaData.set_header_rows or MesaData.set_data_rows</span>
<span class="sd">        have been used to alter how the data have been read in.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bulk_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="n">MesaData</span><span class="o">.</span><span class="n">bulk_names_line</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">names</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bulk_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bulk_data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
        <span class="n">header_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">MesaData</span><span class="o">.</span><span class="n">header_names_line</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">header_names</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">MesaData</span><span class="o">.</span><span class="n">header_names_line</span><span class="p">:</span>
                    <span class="n">header_data</span> <span class="o">=</span> <span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span> <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
                <span class="k">elif</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">MesaData</span><span class="o">.</span><span class="n">header_names_line</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_names</span><span class="p">,</span> <span class="n">header_data</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_backups</span><span class="p">()</span></div>

<div class="viewcode-block" id="MesaData.read_model_data"><a class="viewcode-back" href="../MesaData.html#mesa_reader.MesaData.read_model_data">[docs]</a>    <span class="k">def</span> <span class="nf">read_model_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read in or update data from the original model (.mod) file.</span>

<span class="sd">        Models are assumed to have the following structure:</span>

<span class="sd">        - lines of comments and otherwise [considered] useless information</span>
<span class="sd">        - one or more blank line</span>
<span class="sd">        - Header information (names and values separated by one or more space, one per line)</span>
<span class="sd">        - one or more blank lines</span>
<span class="sd">        - ONE line of column names (strings separated by one or more spaces)</span>
<span class="sd">        - many lines of bulk data (integer followed by many doubles, separated by one or more spaces)</span>
<span class="sd">        - a blank line</span>
<span class="sd">        - everything else is ignored</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">pythonize_number</span><span class="p">(</span><span class="n">num_string</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Convert fotran double [string] to python readable number [string].</span>

<span class="sd">            Converts numbers with exponential notation of D+, D-, d+, or d-</span>
<span class="sd">            to E+ or E- so that a python interpreter properly understands them.</span>
<span class="sd">            Leaves all other strings the untouched.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">num_string</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;(d|D)\+&#39;</span><span class="p">,</span> <span class="s1">&#39;E+&#39;</span><span class="p">,</span> <span class="n">num_string</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;(d|D)-&#39;</span><span class="p">,</span> <span class="s1">&#39;E-&#39;</span><span class="p">,</span> <span class="n">num_string</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="c1"># Walk through file until we get to the last blank line, saving</span>
        <span class="c1"># relevant data as we go.</span>
        <span class="n">blank_line_matcher</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^\s*$&#39;</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">found_blank_line</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">found_blank_line</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">found_blank_line</span> <span class="o">=</span> <span class="p">(</span><span class="n">blank_line_matcher</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># now on blank line 1, advance through one or more lines to get to</span>
        <span class="c1"># header data</span>
        <span class="k">while</span> <span class="n">found_blank_line</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">found_blank_line</span> <span class="o">=</span> <span class="p">(</span><span class="n">blank_line_matcher</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># now done with blank lines and on to header data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">found_blank_line</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="p">[</span><span class="n">datum</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">pythonize_number</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">found_blank_line</span> <span class="o">=</span> <span class="p">(</span><span class="n">blank_line_matcher</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># now on blank line 2, advance until we get to column names</span>
        <span class="k">while</span> <span class="n">found_blank_line</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">found_blank_line</span> <span class="o">=</span> <span class="p">(</span><span class="n">blank_line_matcher</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bulk_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;zone&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bulk_names</span> <span class="o">+=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bulk_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">temp_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">found_blank_line</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">found_blank_line</span><span class="p">:</span>
            <span class="n">temp_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">eval</span><span class="p">(</span><span class="n">pythonize_number</span><span class="p">(</span><span class="n">datum</span><span class="p">))</span> <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span>
                              <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()])</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">found_blank_line</span> <span class="o">=</span> <span class="p">(</span><span class="n">blank_line_matcher</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">temp_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">temp_data</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bulk_names</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bulk_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bulk_names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">temp_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>
            <span class="c1"># self.bulk_data = np.array(temp_data, names=self.bulk_names)</span>

<div class="viewcode-block" id="MesaData.data"><a class="viewcode-back" href="../MesaData.html#mesa_reader.MesaData.data">[docs]</a>    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Accesses the data and returns a numpy array with the appropriate data</span>

<span class="sd">        Accepts a string key, like star_age (for history files) or logRho (for</span>
<span class="sd">        profile files) and returns the corresponding numpy array of data for</span>
<span class="sd">        that data type. Can also just use the shorthand methods that have the</span>
<span class="sd">        same name of the key.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            Name of data. Must match a main data title in the source file. If it</span>
<span class="sd">            is not a data title, will first check for a log_[`key`] or ln[`key`]</span>
<span class="sd">            version and return an exponentiated version of that data. If `key`</span>
<span class="sd">            looks like a `log_*` or `ln_*` name, searches for a linear</span>
<span class="sd">            quantity of the appropriate name and returns the expected</span>
<span class="sd">            logarithmic quantity.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.ndarray</span>
<span class="sd">            Array of values for data corresponding to key at various time steps</span>
<span class="sd">            (history) or grid points (profile or model).</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            If `key` is an invalid key (i.e. not in `self.bulk_names` and no</span>
<span class="sd">            fallback logarithmic or linear quantities found)</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        You can either call `data` explicitly with `key` as an argument, or get</span>
<span class="sd">        the same result by calling it implicitly by treating `key` as an</span>
<span class="sd">        attribute.</span>

<span class="sd">        &gt;&gt;&gt; m = MesaData()</span>
<span class="sd">        &gt;&gt;&gt; x = m.data(&#39;star_age&#39;)</span>
<span class="sd">        &gt;&gt;&gt; y = m.star_age</span>
<span class="sd">        &gt;&gt;&gt; x == y</span>
<span class="sd">        True</span>

<span class="sd">        In this case, x and y are the same because the non-existent method</span>
<span class="sd">        MesaData.star_age will direct to to the corresponding MesaData.data</span>
<span class="sd">        call.</span>

<span class="sd">        Even data categories that are not in the file may still work.</span>
<span class="sd">        Specifically, if a linear quantity is available, but the log is asked</span>
<span class="sd">        for, the linear quantity will be first log-ified and then returned:</span>

<span class="sd">        &gt;&gt;&gt; m = MesaData()</span>
<span class="sd">        &gt;&gt;&gt; m.in_data(&#39;L&#39;)</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; m.in_data(&#39;log_L&#39;)</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; x = m.L</span>
<span class="sd">        &gt;&gt;&gt; y = 10**m.log_L</span>
<span class="sd">        &gt;&gt;&gt; x == y</span>
<span class="sd">        True</span>

<span class="sd">        Here, `data` was called implicitly with an argument of &#39;L&#39; to get `x`.</span>
<span class="sd">        Since `&#39;L&#39;` was an invalid data category, it first looked to see if a</span>
<span class="sd">        logarithmic version existed. Indeed, `&#39;log_L&#39;` was present, so it was</span>
<span class="sd">        retrieved, exponentiated, and returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_data</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bulk_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_version</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">bulk_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_version</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ln_version</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bulk_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ln_version</span><span class="p">(</span><span class="n">key</span><span class="p">)])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exp10_version</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bulk_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_exp10_version</span><span class="p">(</span><span class="n">key</span><span class="p">)])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exp_version</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bulk_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_exp_version</span><span class="p">(</span><span class="n">key</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; is not a valid data type.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MesaData.header"><a class="viewcode-back" href="../MesaData.html#mesa_reader.MesaData.header">[docs]</a>    <span class="k">def</span> <span class="nf">header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Accesses the header, returning a scalar the appropriate data</span>

<span class="sd">        Accepts a string key, like version_number and returns the corresponding</span>
<span class="sd">        datum for that key. Can also just use the shorthand</span>
<span class="sd">        methods that have the same name of the key.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : string</span>
<span class="sd">            Name of data. Must match a main data title in the source file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int or str or float</span>
<span class="sd">            Returns whatever value is below the corresponding key in the header</span>
<span class="sd">            lines of the source file.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            If `key` is an invalid key (i.e. not in `self.header_names`)</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Can call `header` explicitly with `key` as argument or implicitly,</span>
<span class="sd">        treating `key` as an attribute.</span>

<span class="sd">        In this case, x and y are the same because the non-existent method</span>
<span class="sd">        MesaData.version_number will first see if it can call</span>
<span class="sd">        MesaData.data(&#39;version_number&#39;). Then, realizing that this doesn&#39;t make</span>
<span class="sd">        sense, it will instead call MesaData.header(&#39;version_number&#39;)</span>

<span class="sd">        &gt;&gt;&gt; m = MesaData()</span>
<span class="sd">        &gt;&gt;&gt; x = m.data(&#39;version_number&#39;)</span>
<span class="sd">        &gt;&gt;&gt; y = m.version_number</span>
<span class="sd">        &gt;&gt;&gt; x == y</span>
<span class="sd">        True</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_header</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; is not a valid header name.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>

<div class="viewcode-block" id="MesaData.is_history"><a class="viewcode-back" href="../MesaData.html#mesa_reader.MesaData.is_history">[docs]</a>    <span class="k">def</span> <span class="nf">is_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine if the source file is a history file</span>

<span class="sd">        Checks if &#39;model_number&#39; is a valid key for self.data. If it is, return</span>
<span class="sd">        True. Otherwise return False. This is used in determining whether or not</span>
<span class="sd">        to cleanse the file of backups and restarts in the MesaData.read_data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if file is a history file, otherwise False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;model_number&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bulk_names</span></div>

<div class="viewcode-block" id="MesaData.in_header"><a class="viewcode-back" href="../MesaData.html#mesa_reader.MesaData.in_header">[docs]</a>    <span class="k">def</span> <span class="nf">in_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine if `key` is an available header data category.</span>

<span class="sd">        Checks if string `key` is a valid argument of MesaData.header. Returns</span>
<span class="sd">        True if it is, otherwise False</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            Candidate string for accessing header data. This is what you want</span>
<span class="sd">            to be able to use as an argument of `MesaData.header`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if `key` is a valid input to MesaData.header, otherwise False.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This is automatically called by MesaData.header, so the average user</span>
<span class="sd">        shouldn&#39;t need to call it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_names</span></div>

<div class="viewcode-block" id="MesaData.in_data"><a class="viewcode-back" href="../MesaData.html#mesa_reader.MesaData.in_data">[docs]</a>    <span class="k">def</span> <span class="nf">in_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine if `key` is an available main data category.</span>

<span class="sd">        Checks if string `key` is a valid argument of MesaData.data. Returns</span>
<span class="sd">        True if it is, otherwise False</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            Candidate string for accessing main data. This is what you want</span>
<span class="sd">            to be able to use as an argument of MesaData.data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if `key` is a valid input to MesaData.data, otherwise False.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This is automatically called by MesaData.data, so the average user</span>
<span class="sd">        shouldn&#39;t need to call it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bulk_names</span></div>

    <span class="k">def</span> <span class="nf">_log_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine if the log of the desired value is available and return it.</span>

<span class="sd">        If a log_10 version of the value desired is found in the data columns,</span>
<span class="sd">        the &quot;logified&quot; name will be returned. Otherwise it will return `None`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            Candidate string for accessing main data. This is what you want</span>
<span class="sd">            to be able to use as an argument of MesaData.data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str or `None`</span>
<span class="sd">            The &quot;logified&quot; version of the key, if available. If unavailable,</span>
<span class="sd">            `None`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_prefixes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;log_&#39;</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;lg_&#39;</span><span class="p">,</span> <span class="s1">&#39;lg&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">log_prefixes</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_data</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">key</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">key</span>

    <span class="k">def</span> <span class="nf">_ln_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine if the ln of the desired value is available and return it.</span>

<span class="sd">        If a log_e version of the value desired is found in the data columns,</span>
<span class="sd">        the &quot;ln-ified&quot; name will be returned. Otherwise it will return `None`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            Candidate string for accessing main data. This is what you want</span>
<span class="sd">            to be able to use as an argument of MesaData.data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str or `None`</span>
<span class="sd">            The &quot;ln-ified&quot; version of the key, if available. If unavailable,</span>
<span class="sd">            `None`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_prefixes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ln_&#39;</span><span class="p">,</span> <span class="s1">&#39;ln&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">log_prefixes</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_data</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">key</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">key</span>

    <span class="k">def</span> <span class="nf">_exp10_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find if the non-log version of a value is available and return it</span>

<span class="sd">        If a non-log version of the value desired is found in the data columns,</span>
<span class="sd">        the linear name will be returned. Otherwise it will return `None`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            Candidate string for accessing main data. This is what you want</span>
<span class="sd">            to be able to use as an argument of MesaData.data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str or `None`</span>
<span class="sd">            The linear version of the key, if available. If unavailable, `None`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_matcher</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^lo?g_?(.+)&#39;</span><span class="p">)</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">log_matcher</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">matches</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_data</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">return</span> <span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_exp_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find if the non-ln version of a value is available and return it</span>

<span class="sd">        If a non-ln version of the value desired is found in the data columns,</span>
<span class="sd">        the linear name will be returned. Otherwise it will return `None`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            Candidate string for accessing main data. This is what you want</span>
<span class="sd">            to be able to use as an argument of MesaData.data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str or `None`</span>
<span class="sd">            The linear version of the key, if available. If unavailable, `None`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_matcher</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^ln_?(.+)&#39;</span><span class="p">)</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">log_matcher</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">matches</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_data</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">return</span> <span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_any_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine if `key` can point to a valid data category</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            Candidate string for accessing main data. This is what you want</span>
<span class="sd">            to be able to use as an argument of MesaData.data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if `key` can be mapped to a data type either directly or by</span>
<span class="sd">            exponentiating/taking logarithms of existing data types</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_data</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_version</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_ln_version</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exp_version</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_exp10_version</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

<div class="viewcode-block" id="MesaData.data_at_model_number"><a class="viewcode-back" href="../MesaData.html#mesa_reader.MesaData.data_at_model_number">[docs]</a>    <span class="k">def</span> <span class="nf">data_at_model_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">m_num</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return main data at a specific model number (for history files).</span>

<span class="sd">        Finds the index i where MesaData.data(&#39;model_number&#39;)[i] == m_num. Then</span>
<span class="sd">        returns MesaData.data(key)[i]. Essentially lets you use model numbers</span>
<span class="sd">        to index data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            Name of data. Must match a main data title in the source file.</span>

<span class="sd">        m_num : int</span>
<span class="sd">            Model number where you want to sample the data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float or int</span>
<span class="sd">            Value of MesaData.data(`key`) at the same index where</span>
<span class="sd">            MesaData.data(&#39;model_number&#39;) == `m_num`</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        index_of_model_number : returns the index for sampling, not the value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">key</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_of_model_number</span><span class="p">(</span><span class="n">m_num</span><span class="p">)]</span></div>

<div class="viewcode-block" id="MesaData.index_of_model_number"><a class="viewcode-back" href="../MesaData.html#mesa_reader.MesaData.index_of_model_number">[docs]</a>    <span class="k">def</span> <span class="nf">index_of_model_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_num</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return index where MesaData.data(&#39;model_number&#39;) is `m_num`.</span>

<span class="sd">        Returns the index i where MesaData.data(&#39;model_number&#39;)[i] == m_num.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        m_num : int</span>
<span class="sd">            Model number where you want to sample data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The index where MesaData.data(&#39;model_number&#39;) == `m_num`</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        HistoryError</span>
<span class="sd">            If trying to access a non-history file</span>

<span class="sd">        ModelNumberError</span>
<span class="sd">            If zero or more than one model numbers matching `m_num` are found.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        data_at_model_number : returns the datum of a specific key a model no.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_history</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">HistoryError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t get data at model number &quot;</span> <span class="o">+</span>
                               <span class="s2">&quot;because this isn&#39;t a history file&quot;</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;model_number&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">m_num</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ModelNumberError</span><span class="p">(</span><span class="s2">&quot;Found more than one entry where model &quot;</span> <span class="o">+</span>
                                   <span class="s2">&quot;number is &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m_num</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; in &quot;</span> <span class="o">+</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">+</span> <span class="s2">&quot;. Report this.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ModelNumberError</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t find any entries with model &quot;</span> <span class="o">+</span>
                                   <span class="s2">&quot;number &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m_num</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="MesaData.remove_backups"><a class="viewcode-back" href="../MesaData.html#mesa_reader.MesaData.remove_backups">[docs]</a>    <span class="k">def</span> <span class="nf">remove_backups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cleanses a history file of backups and restarts</span>

<span class="sd">        If the file is a history file, goes through and ensure that the</span>
<span class="sd">        model_number data are monotonically increasing. It removes rows of data</span>
<span class="sd">        from all categories if there are earlier ones later in the file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dbg : bool, optional</span>
<span class="sd">            If True, will output how many lines are cleansed. Default is False</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_history</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">dbg</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scrubbing history...&quot;</span><span class="p">)</span>
        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;model_number&#39;</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">smallest_future</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;model_number&#39;</span><span class="p">)[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;model_number&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">smallest_future</span><span class="p">:</span>
                <span class="n">to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_remove</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dbg</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Already clean!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">dbg</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removing </span><span class="si">{}</span><span class="s2"> lines.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">to_remove</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bulk_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bulk_data</span><span class="p">,</span> <span class="n">to_remove</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_any_version</span><span class="p">(</span><span class="n">method_name</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_header</span><span class="p">(</span><span class="n">method_name</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span></div>


<div class="viewcode-block" id="MesaProfileIndex"><a class="viewcode-back" href="../MesaProfileIndex.html#mesa_reader.MesaProfileIndex">[docs]</a><span class="k">class</span> <span class="nc">MesaProfileIndex</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;Structure containing data from the profile index from MESA output.</span>

<span class="sd">    Reads in data from profile index file from MESA, allowing a mapping from</span>
<span class="sd">    profile number to model number and vice versa. Mostly accessed via the</span>
<span class="sd">    MesaLogDir class.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_name : str, optional</span>
<span class="sd">        Path to the profile index file to be read in. Default is</span>
<span class="sd">        &#39;LOGS/profiles.index&#39;, which should work when the working directory is</span>
<span class="sd">        a standard work directory and the logs directory is of the default</span>
<span class="sd">        name.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    file_name : str</span>
<span class="sd">        path to the profile index file</span>
<span class="sd">    index_data : dict</span>
<span class="sd">        dictionary containing all index data in numpy arrays.</span>
<span class="sd">    model_number_string : str</span>
<span class="sd">        header name of the model number column in `file_name`</span>
<span class="sd">    profile_number_string : str</span>
<span class="sd">        header name of the profile number column in `file_name`</span>
<span class="sd">    profile_numbers : numpy.ndarray</span>
<span class="sd">        List of all available profile numbers in order of their corresponding</span>
<span class="sd">        model numbers (i.e. time-order).</span>
<span class="sd">    model_numbers : numpy.ndarray</span>
<span class="sd">        Sorted list of all available model numbers.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">index_start_line</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">index_end</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">index_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;model_numbers&#39;</span><span class="p">,</span> <span class="s1">&#39;priorities&#39;</span><span class="p">,</span> <span class="s1">&#39;profile_numbers&#39;</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">set_index_rows</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">index_start</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">index_end</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">index_start_line</span> <span class="o">=</span> <span class="n">index_start</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">index_end_line</span> <span class="o">=</span> <span class="n">index_end</span>
        <span class="k">return</span> <span class="n">index_start</span><span class="p">,</span> <span class="n">index_end</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">set_index_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name_arr</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">index_names</span> <span class="o">=</span> <span class="n">name_arr</span>
        <span class="k">return</span> <span class="n">name_arr</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;LOGS&#39;</span><span class="p">,</span> <span class="s1">&#39;profiles.index&#39;</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_number_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_number_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_numbers</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_numbers</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_index</span><span class="p">()</span>

<div class="viewcode-block" id="MesaProfileIndex.read_index"><a class="viewcode-back" href="../MesaProfileIndex.html#mesa_reader.MesaProfileIndex.read_index">[docs]</a>    <span class="k">def</span> <span class="nf">read_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read (or re-read) data from `self.file_name`.</span>

<span class="sd">        Read the file into an numpy array, sorting the table in order of</span>
<span class="sd">        increasing model numbers and establishes the `profile_numbers` and</span>
<span class="sd">        `model_numbers` attributes. Converts data and names into a dictionary.</span>
<span class="sd">        Called automatically at instantiation, but may be called again to</span>
<span class="sd">        refresh data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp_index_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="n">MesaProfileIndex</span><span class="o">.</span><span class="n">index_start_line</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_number_string</span> <span class="o">=</span> <span class="n">MesaProfileIndex</span><span class="o">.</span><span class="n">index_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_number_string</span> <span class="o">=</span> <span class="n">MesaProfileIndex</span><span class="o">.</span><span class="n">index_names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_data</span> <span class="o">=</span> <span class="n">temp_index_data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">temp_index_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">MesaProfileIndex</span><span class="o">.</span><span class="n">index_names</span><span class="p">,</span>
                                   <span class="n">temp_index_data</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_numbers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_number_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_numbers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_number_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="MesaProfileIndex.data"><a class="viewcode-back" href="../MesaProfileIndex.html#mesa_reader.MesaProfileIndex.data">[docs]</a>    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Access index data and return array of column corresponding to `key`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            Name of column to be returned. Likely choices are &#39;model_numbers&#39;,</span>
<span class="sd">            &#39;profile_numbers&#39;, or &#39;priorities&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.ndarray</span>
<span class="sd">            Array containing the data requested.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            If input key is not a valid column header name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_names</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; is not a column in &quot;</span> <span class="o">+</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span></div>

<div class="viewcode-block" id="MesaProfileIndex.have_profile_with_model_number"><a class="viewcode-back" href="../MesaProfileIndex.html#mesa_reader.MesaProfileIndex.have_profile_with_model_number">[docs]</a>    <span class="k">def</span> <span class="nf">have_profile_with_model_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determines if given `model_number` has a matching profile number.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        model_number : int</span>
<span class="sd">            model number to be checked for available profile number</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if `model_number` has a corresponding profile number. False</span>
<span class="sd">            otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">model_number</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_number_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="MesaProfileIndex.have_profile_with_profile_number"><a class="viewcode-back" href="../MesaProfileIndex.html#mesa_reader.MesaProfileIndex.have_profile_with_profile_number">[docs]</a>    <span class="k">def</span> <span class="nf">have_profile_with_profile_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">profile_number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determines if given `profile_number` is a valid profile number.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        profile_number : int</span>
<span class="sd">            profile number to be verified</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if `profile_number` has a corresponding entry in the index.</span>
<span class="sd">            False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">profile_number</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_number_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="MesaProfileIndex.profile_with_model_number"><a class="viewcode-back" href="../MesaProfileIndex.html#mesa_reader.MesaProfileIndex.profile_with_model_number">[docs]</a>    <span class="k">def</span> <span class="nf">profile_with_model_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Converts a model number to a profile number if possible.</span>

<span class="sd">        If `model_number` has a corresponding profile number in the index,</span>
<span class="sd">        returns it. Otherwise throws an error.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        model_number : int</span>
<span class="sd">            model number to be converted into a profile number</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            profile number corresponding to `model_number`</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ProfileError</span>
<span class="sd">            If no profile number can be found that corresponds to</span>
<span class="sd">            `model_number`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">have_profile_with_model_number</span><span class="p">(</span><span class="n">model_number</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">ProfileError</span><span class="p">(</span><span class="s2">&quot;No profile with model number &quot;</span> <span class="o">+</span>
                               <span class="nb">str</span><span class="p">(</span><span class="n">model_number</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_number_string</span><span class="p">)</span> <span class="o">==</span> <span class="n">model_number</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_number_string</span><span class="p">),</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="MesaProfileIndex.model_with_profile_number"><a class="viewcode-back" href="../MesaProfileIndex.html#mesa_reader.MesaProfileIndex.model_with_profile_number">[docs]</a>    <span class="k">def</span> <span class="nf">model_with_profile_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">profile_number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Converts a profile number to a profile number if possible.</span>

<span class="sd">        If `profile_number` has a corresponding model number in the index,</span>
<span class="sd">        returns it. Otherwise throws an error.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        profile_number : int</span>
<span class="sd">            profile number to be converted into a model number</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            model number corresponding to `profile_number`</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ProfileError</span>
<span class="sd">            If no model number can be found that corresponds to</span>
<span class="sd">            `profile_number`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">have_profile_with_profile_number</span><span class="p">(</span><span class="n">profile_number</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">ProfileError</span><span class="p">(</span><span class="s2">&quot;No Profile with profile number &quot;</span> <span class="o">+</span>
                               <span class="nb">str</span><span class="p">(</span><span class="n">profile_number</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_number_string</span><span class="p">)</span> <span class="o">==</span> <span class="n">profile_number</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_number_string</span><span class="p">),</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">method_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span></div>


<div class="viewcode-block" id="MesaLogDir"><a class="viewcode-back" href="../MesaLogDir.html#mesa_reader.MesaLogDir">[docs]</a><span class="k">class</span> <span class="nc">MesaLogDir</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;Structure providing access to both history and profile output from MESA</span>

<span class="sd">    Provides access for accessing the history and profile data of a MESA run</span>
<span class="sd">    by linking profiles to the history through model numbers.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    log_path : str, optional</span>
<span class="sd">        Path to the logs directory, default is &#39;LOGS&#39;</span>
<span class="sd">    profile_prefix : str, optional</span>
<span class="sd">        Prefix before profile number in profile file names, default is</span>
<span class="sd">        &#39;profile&#39;</span>
<span class="sd">    profile_suffix : str, optional</span>
<span class="sd">        Suffix after profile number and period for profile file names, default</span>
<span class="sd">        is &#39;data&#39;</span>
<span class="sd">    history_file : str, optional</span>
<span class="sd">        Name of the history file in the logs directory, default is</span>
<span class="sd">        &#39;history.data&#39;</span>
<span class="sd">    index_file : str, optional</span>
<span class="sd">        Name of the profiles index file in the logs directory, default is</span>
<span class="sd">        &#39;profiles.index&#39;</span>
<span class="sd">    memoize_profiles : bool, optional</span>
<span class="sd">        Determines whether or not profiles will be &quot;memo-ized&quot;, default is</span>
<span class="sd">        True. If memoized, once a profile is called into existence, it is saved</span>
<span class="sd">        so that it need not be read in again. Good for quick, clean, repeated</span>
<span class="sd">        access of a profile, but bad for reading in many profiles for one-time</span>
<span class="sd">        uses as it will hog memory.</span>

<span class="sd">    Attributes</span>
<span class="sd">    -----------</span>
<span class="sd">    log_path : str</span>
<span class="sd">        Path to the logs directory; used (re-)reading data in</span>
<span class="sd">    profile_prefix : str</span>
<span class="sd">        Prefix before profile number in profile file names</span>
<span class="sd">    profile_suffix : str</span>
<span class="sd">        Suffix after profile number and period for profile file names</span>
<span class="sd">    history_file : str</span>
<span class="sd">        Base name (not path) of the history file in the logs directory</span>
<span class="sd">    index_file : str</span>
<span class="sd">        Base name (not path) of the profiles index file in the logs directory</span>
<span class="sd">    memoize_profiles : bool</span>
<span class="sd">        Determines whether or not profiles will be &quot;memo-ized&quot;. Setting this</span>
<span class="sd">        after initialization will not delete profiles from memory. It will</span>
<span class="sd">        simply start/stop memoizing them. To clear out memoized profiles,</span>
<span class="sd">        re-read the data with `self.read_logs()`</span>
<span class="sd">    history_path : str</span>
<span class="sd">        Path to the history data file</span>
<span class="sd">    index_path : str</span>
<span class="sd">        Path to the profile index file</span>
<span class="sd">    history : mesa_reader.MesaData</span>
<span class="sd">        MesaData object containing history information from `self.history_path`</span>
<span class="sd">    history_data : mesa_reader.MesaData</span>
<span class="sd">        Alias for `self.history`</span>
<span class="sd">    profiles : mesa_reader.MesaProfileIndex</span>
<span class="sd">        MesaProfileIndex from profiles in `self.index_path`</span>
<span class="sd">    profile_numbers : numpy.ndarray</span>
<span class="sd">        Result of calling `self.profiles.profile_numbers`. Just the profile</span>
<span class="sd">        numbers of the simulation in order of corresponding model numbers.</span>
<span class="sd">    model_numbers : numpy.ndarray</span>
<span class="sd">        Result of calling `self.profiles.model_numbers`. Just the model numbers</span>
<span class="sd">        of the simulations that have corresponding profiles in ascending order.</span>
<span class="sd">    profile_dict : dict</span>
<span class="sd">        Stores MesaData objects from profiles. Keys to this dictionary are</span>
<span class="sd">        profile numbers, so presumably `self.profile_dict(5)` would yield the</span>
<span class="sd">        MesaData object obtained from the file `profile5.data` (assuming</span>
<span class="sd">        reasonable defaults) if such a profile was ever accessed. Will remain</span>
<span class="sd">        empty if memoization is shut off.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_path</span><span class="o">=</span><span class="s1">&#39;LOGS&#39;</span><span class="p">,</span> <span class="n">profile_prefix</span><span class="o">=</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span>
                 <span class="n">profile_suffix</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">history_file</span><span class="o">=</span><span class="s1">&#39;history.data&#39;</span><span class="p">,</span>
                 <span class="n">index_file</span><span class="o">=</span><span class="s1">&#39;profiles.index&#39;</span><span class="p">,</span> <span class="n">memoize_profiles</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_path</span> <span class="o">=</span> <span class="n">log_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_prefix</span> <span class="o">=</span> <span class="n">profile_prefix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_suffix</span> <span class="o">=</span> <span class="n">profile_suffix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history_file</span> <span class="o">=</span> <span class="n">history_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_file</span> <span class="o">=</span> <span class="n">index_file</span>

        <span class="c1"># Check if log_path and files are dir/files.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">BadPathError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_path</span> <span class="o">+</span> <span class="s1">&#39; is not a valid directory.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">history_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">history_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">BadPathError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history_file</span> <span class="o">+</span> <span class="s1">&#39; not found in &#39;</span> <span class="o">+</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">log_path</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">index_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">BadPathError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_file</span> <span class="o">+</span> <span class="s1">&#39; not found in &#39;</span> <span class="o">+</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">log_path</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">memoize_profiles</span> <span class="o">=</span> <span class="n">memoize_profiles</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_numbers</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_numbers</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_logs</span><span class="p">()</span>

<div class="viewcode-block" id="MesaLogDir.read_logs"><a class="viewcode-back" href="../MesaLogDir.html#mesa_reader.MesaLogDir.read_logs">[docs]</a>    <span class="k">def</span> <span class="nf">read_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read (or re-read) data from the history and profile index.</span>

<span class="sd">        Reads in `self.history_path` and `self.index_file` for use in getting</span>
<span class="sd">        history data and profile information. This is automatically called at</span>
<span class="sd">        instantiation, but can be recalled by the user if for some reason the</span>
<span class="sd">        data needs to be refreshed (for instance, after changing some of the</span>
<span class="sd">        reader methods to read in specially-formatted output.)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        This, if called after initialization, will empty `self.profile_dict`,</span>
<span class="sd">        erasing all memo-ized profiles.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="n">MesaData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span> <span class="o">=</span> <span class="n">MesaProfileIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_numbers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">profile_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_numbers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">model_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span></div>

<div class="viewcode-block" id="MesaLogDir.have_profile_with_model_number"><a class="viewcode-back" href="../MesaLogDir.html#mesa_reader.MesaLogDir.have_profile_with_model_number">[docs]</a>    <span class="k">def</span> <span class="nf">have_profile_with_model_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_num</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks to see if a model number has a corresponding profile number.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        m_num : int</span>
<span class="sd">            model number to be checked</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if the model number is in `self.model_numbers`, otherwise</span>
<span class="sd">            False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">have_profile_with_model_number</span><span class="p">(</span><span class="n">m_num</span><span class="p">)</span></div>

<div class="viewcode-block" id="MesaLogDir.have_profile_with_profile_number"><a class="viewcode-back" href="../MesaLogDir.html#mesa_reader.MesaLogDir.have_profile_with_profile_number">[docs]</a>    <span class="k">def</span> <span class="nf">have_profile_with_profile_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_num</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks to see if a given number is a valid profile number.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p_num : int</span>
<span class="sd">            profile number to be checked</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if profile number is in `self.profile_numbers`, otherwise</span>
<span class="sd">            False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">have_profile_with_profile_number</span><span class="p">(</span><span class="n">p_num</span><span class="p">)</span></div>

<div class="viewcode-block" id="MesaLogDir.profile_with_model_number"><a class="viewcode-back" href="../MesaLogDir.html#mesa_reader.MesaLogDir.profile_with_model_number">[docs]</a>    <span class="k">def</span> <span class="nf">profile_with_model_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_num</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Converts a model number to a corresponding profile number</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        m_num : int</span>
<span class="sd">            model number to be converted</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            profile number that corresponds to `m_num`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">profile_with_model_number</span><span class="p">(</span><span class="n">m_num</span><span class="p">)</span></div>

<div class="viewcode-block" id="MesaLogDir.model_with_profile_number"><a class="viewcode-back" href="../MesaLogDir.html#mesa_reader.MesaLogDir.model_with_profile_number">[docs]</a>    <span class="k">def</span> <span class="nf">model_with_profile_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_num</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Converts a profile number to a corresponding model number</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p_num : int</span>
<span class="sd">            profile number to be converted</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            model number that corresponds to `p_num`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">model_with_profile_number</span><span class="p">(</span><span class="n">p_num</span><span class="p">)</span></div>

<div class="viewcode-block" id="MesaLogDir.profile_data"><a class="viewcode-back" href="../MesaLogDir.html#mesa_reader.MesaLogDir.profile_data">[docs]</a>    <span class="k">def</span> <span class="nf">profile_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_number</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">profile_number</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate or retrieve MesaData from a model or profile number.</span>

<span class="sd">        If both a model number and a profile number is given, the model number</span>
<span class="sd">        takes precedence. If neither are given, the default is to return a</span>
<span class="sd">        MesaData object of the last profile (biggest model number). In either</span>
<span class="sd">        case, this generates (if it doesn&#39;t already exist) or retrieves (if it</span>
<span class="sd">        has already been generated and memoized) a MesaData object from the</span>
<span class="sd">        corresponding profile data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model_number : int, optional</span>
<span class="sd">            model number for the profile MesaData object desired. Default is</span>
<span class="sd">            -1, corresponding to the last model number.</span>
<span class="sd">        profile_number : int, optional</span>
<span class="sd">            profile number for the profile MesaData object desired. Default is</span>
<span class="sd">            -1, corresponding to the last model number. If both `model_number`</span>
<span class="sd">            and `profile_number` are given, `profile_number` is ignored.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mesa_reader.MesaData</span>
<span class="sd">            Data for profile with desired model/profile number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">model_number</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">profile_number</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">to_use</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_numbers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">to_use</span> <span class="o">=</span> <span class="n">profile_number</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">to_use</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_with_model_number</span><span class="p">(</span><span class="n">model_number</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">to_use</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_dict</span><span class="p">[</span><span class="n">to_use</span><span class="p">]</span>

        <span class="n">file_name</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_path</span><span class="p">,</span>
                         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">to_use</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">profile_suffix</span><span class="p">))</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">MesaData</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">memoize_profiles</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profile_dict</span><span class="p">[</span><span class="n">to_use</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
        <span class="k">return</span> <span class="n">p</span></div>

<div class="viewcode-block" id="MesaLogDir.select_models"><a class="viewcode-back" href="../MesaLogDir.html#mesa_reader.MesaLogDir.select_models">[docs]</a>    <span class="k">def</span> <span class="nf">select_models</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">keys</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Yields model numbers for profiles that satisfy a given criteria.</span>

<span class="sd">        Given a function `f` of various time-domain (history) variables,</span>
<span class="sd">        `*keys` (i.e., categories in `self.history.bulk_names`), filters</span>
<span class="sd">        `self.model_numbers` and returns all model numbers that satisfy the</span>
<span class="sd">        criteria.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        f : function</span>
<span class="sd">            A function of the same number of parameters as strings given for</span>
<span class="sd">            `keys` that returns a boolean. Should evaluate to `True` when</span>
<span class="sd">            condition is met and `False` otherwise.</span>
<span class="sd">        keys : str</span>
<span class="sd">            Name of data categories from `self.history.bulk_names` whose values</span>
<span class="sd">            are to be used in the arguments to `f`, in the same order that they</span>
<span class="sd">            appear as arguments in `f`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.ndarray</span>
<span class="sd">            Array of model numbers that have corresponding profiles where the</span>
<span class="sd">            condition given by `f` is `True`.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            If any of the `keys` are invalid history keys.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; l = MesaLogDir()</span>
<span class="sd">        &gt;&gt;&gt; def is_old_and_bright(age, log_lum):</span>
<span class="sd">        &gt;&gt;&gt;     return age &gt; 1e9 and log_lum &gt; 3</span>
<span class="sd">        &gt;&gt;&gt; m_nums = l.select_models(is_old_and_bright, &#39;star_age&#39;, &#39;log_L&#39;)</span>

<span class="sd">        Here, `m_nums` will contain all model numbers that have profiles where</span>
<span class="sd">        the age is greater than a billion years and the luminosity is greater</span>
<span class="sd">        than 1000 Lsun, provided that &#39;star_age&#39; and &#39;log_L&#39; are in</span>
<span class="sd">        `self.history.bulk_names`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">in_data</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; is not a valid data type.&quot;</span><span class="p">)</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">m_num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_numbers</span><span class="p">:</span>
            <span class="n">this_input</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="n">this_input</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">data_at_model_number</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">m_num</span><span class="p">))</span>
            <span class="n">inputs</span><span class="p">[</span><span class="n">m_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_input</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">inputs</span><span class="p">[</span><span class="n">m_num</span><span class="p">])</span> <span class="k">for</span> <span class="n">m_num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_numbers</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_numbers</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span></div></div>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, William Wolf and Josiah Schwab.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'3.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>